# テスト計画（初版）

## 目的
実装後に主要機能が要件通り動くことを確認するための指針。モバイル利用を前提に、ルーティングとオフライン動作を含めてカバーする。

## テスト範囲
- ルーティング: `/` と各 `/tools/:id` ページの表示、タイトル更新、スクロール挙動。
- 各ツールページ:
  - 点数計算/符計算
  - 待ち牌/受け入れ
  - 役一覧
  - 点差逆転
  - 何切る練習
  - 牌理可視化
  - 早見表
  - リーチ vs ダマ EV
  - 点棒管理
  - 牌譜ビューア
- オフライン: SW キャッシュ後にオフラインで主要画面が開き、計算系が動くこと。
- 非機能: モバイル幅でのレイアウト崩れがないこと。

## テスト種別と方法
- ユニットテスト（vitest）
  - 対象: `src/lib/mahjong.ts`
  - ケース例:
    - 点数計算: 翻/符の境界（3翻70符→満貫、4翻40符→満貫、5翻→跳/倍満…など）
    - 待ち判定: 聴牌/不聴の判定、受け入れ枚数の計算（単騎/両面/カンチャンなど）
    - 形サマリ: 刻子/順子/対子/孤立牌の抽出
  - 目的: 算出ロジックの回帰防止。
- スモークテスト（手動）
  - 各ページが読み込みエラーなく開くこと。
  - 主要入力 → 出力が表示されること（下記簡易シナリオ参照）。
  - ルート遷移後のスクロールリセット、タイトル反映。
- UI/レイアウト確認（手動）
  - モバイル幅（iPhone 13/Pixel 6 相当）での表示崩れ有無。
  - ボタン/入力のタップ領域が十分（約44px以上）。
- オフライン確認（手動）
  - 初回オンラインで一度アクセス → オフラインにして主要ページが開き計算が動くことを確認。

## 簡易シナリオ例（手動）
- 点数計算: 翻=3, 符=40 → 満貫表示/子ロン 7700 を確認。親/子切替で値が変わること。
- 受け入れ: `123m456p789s東東南南` を13枚入力 → 待ちが表示されること。14枚にして何切る提案が出ること。
- 役一覧: 「タンヤオ」で検索 → 該当役のみ表示。タグフィルタが効くこと。
- 点差逆転: 自分24000, 相手32000, 子ツモ → 必要加点が表示されること。
- 何切る練習: 問題を選び、選択肢を押すとフィードバックが表示されること。
- 牌理可視化: 手牌入力で刻子/順子/対子/孤立牌が分類されること。
- 早見表: 翻スライダー操作でテーブル値が更新されること。
- リーチ vs ダマ: 和了率/放銃率を変更すると EV と差分が更新されること。
- 点棒管理: 点数増減とリセットが機能すること。
- 牌譜ビューア: サンプル JSON を貼り付け、前後ボタンでステップが進むこと。

## 端末/ブラウザ
- iOS Safari（最新）
- Android Chrome（最新）
- デスクトップ Chrome（開発確認用、モバイル幅でチェック）

## 実行タイミング
- 実装完了後にスモーク + レイアウト + オフライン確認。
- 重要ロジック変更時にユニットテストを追加/更新し、CI を通す。
